<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Редактор для Пузырьков by Nika Shum</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
    }

    .task-editor {
      margin-bottom: 20px;
    }

    .task-editor input,
    .task-editor textarea {
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }

    .task-editor button {
      padding: 10px 20px;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .task-editor button:hover {
      background-color: #45a049;
    }

    #bubble-preview {
      position: relative;
      width: 100%;
      height: 400px;
      background-color: #e1e1e1;
      border-radius: 10px;
    }

    .code-output {
      margin-top: 20px;
      background: #f6f9fc;
      padding: 10px;
      border-radius: 5px;
      font-family: monospace;
      white-space: pre-wrap;
    }

    .task-inputs {
      margin-top: 20px;
    }

    .task-inputs input, .task-inputs textarea {
      margin-bottom: 10px;
    }

    .bubble {
      position: absolute;
      width: 80px;
      height: 80px;
      opacity: 0.6;
      pointer-events: auto;
      cursor: pointer;
      z-index: 100;
    }
  </style>
</head>
<body>
  <h2>Редактор для Пузырьков</h2>

  <!-- 20 полей для ввода текстов заданий -->
  <div class="task-inputs">
    <h3>Задания для пузырьков (20 шт.)</h3>
    <div id="task-list">
      <!-- Здесь будут созданы 20 полей для ввода -->
    </div>

    <label for="bubble-image">Изображение для Пузырьков (URL):</label>
    <input id="bubble-image" type="text" placeholder="Вставьте ссылку на изображение для пузырьков">

    <label for="feedback-text">Текст фидбека:</label>
    <textarea id="feedback-text" placeholder="Введите текст фидбека (например, 'Well Done!')"></textarea>

    <button id="save-button">Сгенерировать код для вставки</button>
  </div>

  <div id="bubble-preview">
    <img id="preview-bubble" src="https://media.tenor.com/mqvTrVZEMxIAAAAi/bubble-bfdi.gif" alt="Bubble Preview" style="width: 80px; height: 80px; position: absolute;">
  </div>

  <div class="code-output" id="iframe-code">
    <!-- Здесь будет сгенерирован код iframe -->
  </div>

  <script>
    const saveButton = document.getElementById('save-button');
    const bubbleImageInput = document.getElementById('bubble-image');
    const previewBubble = document.getElementById('preview-bubble');
    const iframeCodeOutput = document.getElementById('iframe-code');
    const feedbackTextInput = document.getElementById('feedback-text');

    const taskList = document.getElementById('task-list');

    // Генерация 20 полей для ввода заданий
    for (let i = 1; i <= 20; i++) {
      const taskDiv = document.createElement('div');
      taskDiv.innerHTML = `
        <label for="task${i}">Задание ${i}:</label>
        <textarea id="task${i}" placeholder="Введите текст задания для пузырька ${i}"></textarea>
      `;
      taskList.appendChild(taskDiv);
    }

    // Загрузка данных из localStorage
    window.onload = () => {
      const savedImage = localStorage.getItem('bubbleImage');
      const savedFeedback = localStorage.getItem('feedbackText');
      if (savedImage) {
        bubbleImageInput.value = savedImage;
        previewBubble.src = savedImage;
      }
      if (savedFeedback) {
        feedbackTextInput.value = savedFeedback;
      }

      // Загружаем задания
      for (let i = 1; i <= 20; i++) {
        const savedTask = localStorage.getItem(`task${i}`);
        if (savedTask) {
          document.getElementById(`task${i}`).value = savedTask;
        }
      }
    };

    // Сохранение данных и генерация iframe кода
    saveButton.addEventListener('click', () => {
      const tasks = [];
      for (let i = 1; i <= 20; i++) {
        const taskValue = document.getElementById(`task${i}`).value;
        tasks.push(taskValue);
        localStorage.setItem(`task${i}`, taskValue); // Сохранение задания в localStorage
      }

      const bubbleImageValue = bubbleImageInput.value;
      const feedbackTextValue = feedbackTextInput.value;

      localStorage.setItem('bubbleImage', bubbleImageValue); // Сохранение изображения в localStorage
      localStorage.setItem('feedbackText', feedbackTextValue); // Сохранение фидбека в localStorage

      // Обновление изображения на превью
      previewBubble.src = bubbleImageValue;

      // Генерация пузырьков в зависимости от количества заполненных заданий
      const bubbles = [];
      let bubbleCount = 0;
      tasks.forEach((task, index) => {
        if (task.trim() !== '') {
          bubbleCount++;
        }
      });

      const iframeCode = `
<iframe src="https://nikashum93.github.io/pusyriki/?tasks=${encodeURIComponent(JSON.stringify(tasks))}&image=${encodeURIComponent(bubbleImageValue)}&feedback=${encodeURIComponent(feedbackTextValue)}&bubbles=${bubbleCount}" width="600" height="400" frameborder="0" allowfullscreen></iframe>
      `;
      iframeCodeOutput.textContent = iframeCode; // Показать сгенерированный iframe код
      alert('Код сгенерирован! Копируйте его в Genially.');
    });
  </script>
</body>
</html>
