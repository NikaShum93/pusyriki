<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ü—É–∑—ã—Ä—å–∫–∏ by Nika Shum</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: transparent;
      padding: 0;
      margin: 0;
      box-sizing: border-box;
    }

    .bubble-container {
      position: relative;
      width: 100%;
      height: 100vh;
      background-color: transparent;
    }

    .bubble {
      position: absolute;
      width: 80px;
      height: 80px;
      opacity: 0.6;
      pointer-events: auto;
      cursor: pointer;
      z-index: 100;
    }

    #counter {
      position: absolute;
      top: 20px;
      left: 20px;
      background: linear-gradient(135deg, #f6f9fc, #dff9fb);
      padding: 10px 16px;
      border-radius: 12px;
      font-family: sans-serif;
      font-size: 18px;
      color: #2d3436;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 300;
      pointer-events: none;
    }

  </style>
</head>
<body>

  <div class="bubble-container" id="bubble-container"></div>
  <div id="counter">ü´ß <strong>0 / 0</strong></div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const tasks = JSON.parse(decodeURIComponent(urlParams.get('tasks') || '[]'));
    const bubbleImage = decodeURIComponent(urlParams.get('image') || 'https://media.tenor.com/mqvTrVZEMxIAAAAi/bubble-bfdi.gif');
    const feedbackText = decodeURIComponent(urlParams.get('feedback') || 'Well Done!');
    const bubbleCount = parseInt(urlParams.get('bubbles') || '0');

    const bubbleContainer = document.getElementById('bubble-container');
    const counter = document.getElementById('counter');
    let popped = 0;

    // –î–≤–∏–≥–∞–µ–º –ø—É–∑—ã—Ä—å–∫–∏ –º–µ–¥–ª–µ–Ω–Ω–æ
    const dx = 0.5; // –°–Ω–∏–∂–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ –æ—Å–∏ X
    const dy = 0.5; // –°–Ω–∏–∂–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –Ω–∞ –æ—Å–∏ Y

    // –°–æ–∑–¥–∞–Ω–∏–µ –ø—É–∑—ã—Ä—å–∫–æ–≤
    for (let i = 0; i < bubbleCount; i++) {
      const bubble = document.createElement('img');
      bubble.src = bubbleImage;
      bubble.classList.add('bubble');
      bubble.style.left = `${Math.random() * 90}%`;
      bubble.style.top = `${Math.random() * 90}%`;

      let xSpeed = (Math.random() - 0.5) * dx;
      let ySpeed = (Math.random() - 0.5) * dy;

      bubble.addEventListener('click', () => {
        const popSound = new Audio('https://nikashum93.github.io/bubbles-by-nika-shum/pop.mp3');
        popSound.play().catch(() => {});
        bubble.remove();
        showMessage(i + 1); // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ –∫–ª–∏–∫—É
        popped++;
        counter.innerHTML = `ü´ß <strong>${popped} / ${bubbleCount}</strong>`;
      });

      bubbleContainer.appendChild(bubble);

      // –î–≤–∏–∂–µ–Ω–∏–µ –ø—É–∑—ã—Ä—å–∫–æ–≤
      function moveBubble() {
        let x = bubble.offsetLeft + xSpeed;
        let y = bubble.offsetTop + ySpeed;

        if (x < 0 || x > window.innerWidth - 80) xSpeed = -xSpeed + (Math.random() - 0.5) * dx;
        if (y < 0 || y > window.innerHeight - 80) ySpeed = -ySpeed + (Math.random() - 0.5) * dy;

        bubble.style.left = `${x}px`;
        bubble.style.top = `${y}px`;

        requestAnimationFrame(moveBubble);
      }
      moveBubble();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è
    function showMessage(id) {
      const msg = document.createElement('div');
      msg.innerHTML = tasks[id - 1] || `<b>–ó–∞–¥–∞–Ω–∏–µ ${id}</b>`;
      Object.assign(msg.style, {
        position: 'absolute',
        top: '50%',
        left: '50%',
        transform: 'translate(-50%, -50%)',
        background: 'linear-gradient(135deg, #4facfe, #00f2fe)',
        color: 'white',
        padding: '24px 36px',
        borderRadius: '20px',
        fontSize: '22px',
        fontFamily: 'sans-serif',
        textAlign: 'center',
        boxShadow: '0 6px 16px rgba(0,0,0,0.3)',
        pointerEvents: 'auto',
        cursor: 'pointer',
        zIndex: 200
      });

      msg.addEventListener('click', () => {
        msg.remove();
        if (popped === bubbleCount) {
          showFinal();
        }
      });

      bubbleContainer.appendChild(msg);
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∏–¥–±–µ–∫–∞
    function showFinal() {
      const chest = document.createElement('img');
      chest.src = 'https://img.genially.com/64233afb55129a0017751c8e/915b9b98-7a24-4b3f-887a-28042ba9acca.png';
      Object.assign(chest.style, {
        position: 'absolute',
        top: '50%',
        left: '50%',
        transform: 'translate(-50%, -50%) scale(1)',
        width: '240px',
        cursor: 'pointer',
        zIndex: 300,
        pointerEvents: 'auto',
        transition: 'transform 0.3s ease'
      });
      bubbleContainer.appendChild(chest);

      chest.addEventListener('click', () => {
        chest.src = 'https://img.genially.com/64233afb55129a0017751c8e/d76550fd-2622-441f-bbf2-faee6906772e.png';
        chest.style.transform = 'translate(-50%, -50%) scale(1.1)';
        const label = document.createElement('div');
        label.textContent = feedbackText;
        Object.assign(label.style, {
          position: 'absolute',
          top: '40%',
          left: '50%',
          transform: 'translate(-50%, -50%)',
          fontSize: '36px',
          fontWeight: 'bold',
          color: '#fff',
          padding: '20px 40px',
          background: 'linear-gradient(135deg, #e67e22, #f1c40f)',
          borderRadius: '16px',
          fontFamily: 'Comic Sans MS, sans-serif',
          boxShadow: '0 8px 20px rgba(0,0,0,0.3)',
          zIndex: 400,
          pointerEvents: 'none',
          textShadow: '2px 2px 6px rgba(0,0,0,0.4)'
        });
        bubbleContainer.appendChild(label);
        setTimeout(() => label.remove(), 2500);

        // –ó–≤—É–∫ –æ—Ç–∫—Ä—ã—Ç–∏—è —Å—É–Ω–¥—É–∫–∞
        const openSound = new Audio('https://nikashum93.github.io/bubbles-by-nika-shum/open.mp3');
        openSound.play().catch(() => {});
      });
    }
  </script>

</body>
</html>
